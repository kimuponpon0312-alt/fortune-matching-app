/**
 * 四柱推命の日干計算と相性判定
 */

// 十干の定義
export type Tenkan = "甲" | "乙" | "丙" | "丁" | "戊" | "己" | "庚" | "辛" | "壬" | "癸";

// 十干の配列
const TENKAN_ARRAY: Tenkan[] = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];

// 十干から親しみやすい名称へのマッピング
export const TENKAN_NAMES: Record<Tenkan, string> = {
  甲: "大樹",
  乙: "草花",
  丙: "太陽",
  丁: "灯火",
  戊: "山",
  己: "大地",
  庚: "鉄",
  辛: "宝石",
  壬: "海",
  癸: "雨",
};

// 十干の説明
export const TENKAN_DESCRIPTIONS: Record<Tenkan, string> = {
  甲: "根を深く張り、誰もが頼る巨木。長期戦に強く、堂々と仲間を支えるカリスマ。",
  乙: "柔らかな草花のように、しなやかで気品ある調和者。繊細な感性で場を美しくまとめる人。",
  丙: "曇天を切り裂く太陽。存在するだけで周囲を照らし、動かし、未来を開く推進力を持つ。",
  丁: "夜を優しく照らす灯火。心を温め、陰を希望に変える献身と包容力の人。",
  戊: "山のごとく動じない守護者。静かに構え、要となって人を安心させる求心力を持つ。",
  己: "豊潤な大地。実務と現実を司り、着実に価値を育てるプロデューサータイプ。",
  庚: "鋼の意志を宿す鉄。決断力と実行力で道を切り開く、信頼のエンジン。",
  辛: "磨き抜かれた宝石。美意識と精度を極め、周囲の質を底上げする洗練の象徴。",
  壬: "大海のような包容力。自由で創造的な発想で境界を越え、可能性を広げる人。",
  癸: "静かな雨。潤いをもたらし、枯れた心を蘇らせる。変化に柔軟で、調和を整える名手。",
};

// 干合のマッピング（相性抜群の組み合わせ）
export const GOUGOU_PAIRS: Record<Tenkan, Tenkan> = {
  甲: "己",
  乙: "庚",
  丙: "辛",
  丁: "壬",
  戊: "癸",
  己: "甲",
  庚: "乙",
  辛: "丙",
  壬: "丁",
  癸: "戊",
};

/**
 * 生年月日から日干を計算する
 * 四柱推命の日干は、生年月日の干支から算出されます
 * 簡易版：1924年2月5日（甲子日）を基準日として計算
 * 注意：正確な四柱推命の計算には旧暦への変換が必要ですが、プロトタイプでは簡易計算を使用
 */
export function calculateTenkan(year: number, month: number, day: number): Tenkan {
  // 1924年2月5日（甲子日）を基準とする（より正確な基準日）
  const baseDate = new Date(1924, 1, 5); // 月は0ベースなので1が2月
  const targetDate = new Date(year, month - 1, day);
  
  // 日数の差分を計算
  const diffTime = targetDate.getTime() - baseDate.getTime();
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
  
  // 基準日の十干は「甲」（インデックス0）
  // 10日周期で十干が循環する
  const tenkanIndex = (diffDays % 10 + 10) % 10;
  
  return TENKAN_ARRAY[tenkanIndex];
}

/**
 * 相性抜群の相手タイプを取得
 */
export function getCompatibleTenkan(tenkan: Tenkan): Tenkan {
  return GOUGOU_PAIRS[tenkan];
}

/**
 * 生年月日のバリデーション
 */
export function validateBirthDate(year: number, month: number, day: number): boolean {
  if (year < 1900 || year > 2100) return false;
  if (month < 1 || month > 12) return false;
  if (day < 1 || day > 31) return false;
  
  const date = new Date(year, month - 1, day);
  return (
    date.getFullYear() === year &&
    date.getMonth() === month - 1 &&
    date.getDate() === day
  );
}

/**
 * 占いの詳細情報
 */
export interface FortuneDetails {
  todayFortune: string;
  advice: string;
  meetingPeriod: string;
  luckyPlace: string;
  luckyItem: string;
}

// 今日の運勢（十干別）
export const TODAY_FORTUNE: Record<Tenkan, string> = {
  甲: "重厚な根が揺るがず、静かな追い風が吹く日。長期的な構想が形になる兆し。",
  乙: "繊細な感性に光が当たる日。小さな心配りが大きな信頼へと育つ。",
  丙: "曇り空を突き抜けるような陽光。あなたが動けば場全体が熱を帯びる。",
  丁: "柔らかな灯が周囲を包む日。優しさが評価され、深い縁が芽生える。",
  戊: "山の静けさの中で的確な一手を打てる日。腰を据えた判断が未来を固める。",
  己: "大地が実りを受け取る日。手をかけてきたものが静かに成果をもたらす。",
  庚: "鋼を鍛える火が宿る日。決断と実行が評価され、信頼が一段上がる。",
  辛: "磨かれた輝きに注目が集まる日。質の高い選択があなたの価値を高める。",
  壬: "大海に新しい航路がひらける日。自由な発想が人を惹きつけ、共鳴が生まれる。",
  癸: "静かな雨が乾いた大地を潤す日。丁寧な対話が心の距離を縮める。",
};

// 開運の助言（十干別）
export const FORTUNE_ADVICE: Record<Tenkan, string> = {
  甲: "長期計画を一枚にまとめ、誰と進むかを明確に。信頼できる右腕を選ぶこと。",
  乙: "言葉を丁寧に紡ぎ、相手の美点を言語化する。小さな礼を欠かさないこと。",
  丙: "今日の主役はあなた。迷ったら先に動き、周囲を巻き込み温度を上げること。",
  丁: "一人ひとりの話を深く聴く。静かな席で、心を照らす言葉を一つ届けること。",
  戊: "重要案件は腹に落とし、結論を端的に伝える。守るべき軸を一行で示すこと。",
  己: "投資と回収のバランスを見直す。不要を削り、本質に時間と資源を注ぐこと。",
  庚: "「決める・動く・やり切る」を一気通貫で。数値と期限を伴う宣言が吉。",
  辛: "質を最優先に。ひとつの選択で全体の格が上がる。磨き上げたものを提示すること。",
  壬: "境界を超える対話を。異業種・異文化の人と語り、新しい視点を受け入れること。",
  癸: "余白と休息を確保し、静かな場所で思考を整える。手紙やメッセージで温度を伝えること。",
};

// 二人が出会うべき時期（十干別）
export const MEETING_PERIOD: Record<Tenkan, string> = {
  甲: "春の訪れと共に、運命の相手との出会いが訪れます。3月から5月にかけて、新しい出会いのチャンスが広がります。",
  乙: "花が咲き誇る季節、特に4月から6月にかけて、美しい縁が結ばれるでしょう。",
  丙: "夏の太陽が輝く時期、6月から8月が最も運気が高い時期です。明るい場所で出会いが待っています。",
  丁: "秋の夜長、9月から11月にかけて、温かい出会いがあなたを待っています。",
  戊: "一年を通じて安定した運気ですが、特に9月から12月にかけて、深い絆が生まれるでしょう。",
  己: "上質な時間が流れる秋から冬、10月から1月にかけて、洗練された出会いが訪れます。",
  庚: "意志の強さが試される冬から春、12月から3月にかけて、真剣な出会いが待っています。",
  辛: "美しさが際立つ季節、特に11月から2月にかけて、魅力的な出会いが訪れるでしょう。",
  壬: "自由な風が吹く春から夏、2月から7月にかけて、創造的な出会いが待っています。",
  癸: "優しい雨が降る季節、特に5月から8月にかけて、思いやりのある出会いが訪れます。",
};

// 幸運の場所（十干別）
export const LUCKY_PLACE: Record<Tenkan, string> = {
  甲: "木の香りがするラウンジ、高層の眺望フロア、静かなガーデンテラス。",
  乙: "生花が飾られたギャラリー、緑が映えるカフェ、和の中庭。",
  丙: "日差しの入るラウンジ、海を望むテラス、屋上のバー。",
  丁: "暖色の照明が灯るレストラン、古書店の一角、暖炉のあるラウンジ。",
  戊: "寺社の参道、歴史ある庭園、石畳の落ち着いた街並み。",
  己: "クラシックなホテルラウンジ、ワインセラー併設のダイニング、上質なメンバーズクラブ。",
  庚: "現代アートと金属オブジェが映える空間、モダンなバー、重厚なカウンター席。",
  辛: "ジュエリーショップ併設のカフェ、ラグジュアリーブランドのラウンジ、ライティングが美しいギャラリー。",
  壬: "海沿いのボードウォーク、広い水盤のある中庭、リバーサイドのテラス席。",
  癸: "しっとりとした茶室、音楽と水音が響くラウンジ、雨の日に映えるガラス張りのカフェ。",
};

// ラッキーアイテム（十干別）
export const LUCKY_ITEM: Record<Tenkan, string> = {
  甲: "木目の美しいノートカバー",
  乙: "上質なリネンのハンカチ",
  丙: "ゴールドのタイバー／ブローチ",
  丁: "琥珀色のキャンドル",
  戊: "重厚なレザーの手帳",
  己: "土色の陶器マグ",
  庚: "ステンレスの万年筆",
  辛: "小粒ダイヤのアクセサリー",
  壬: "ネイビーのスカーフ",
  癸: "ガラスの一輪挿し",
};

/**
 * 占いの詳細情報を取得
 */
export function getFortuneDetails(tenkan: Tenkan): FortuneDetails {
  return {
    todayFortune: TODAY_FORTUNE[tenkan],
    advice: FORTUNE_ADVICE[tenkan],
    meetingPeriod: MEETING_PERIOD[tenkan],
    luckyPlace: LUCKY_PLACE[tenkan],
    luckyItem: LUCKY_ITEM[tenkan],
  };
}
