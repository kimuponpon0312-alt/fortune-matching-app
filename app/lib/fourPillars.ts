/**
 * 四柱推命の日干計算と相性判定
 */

// 十干の定義
export type Tenkan = "甲" | "乙" | "丙" | "丁" | "戊" | "己" | "庚" | "辛" | "壬" | "癸";

// 十干の配列
const TENKAN_ARRAY: Tenkan[] = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];

// 十干から親しみやすい名称へのマッピング
export const TENKAN_NAMES: Record<Tenkan, string> = {
  甲: "大樹",
  乙: "花",
  丙: "太陽",
  丁: "灯火",
  戊: "大地",
  己: "宝石",
  庚: "金属",
  辛: "宝石",
  壬: "大海",
  癸: "雨露",
};

// 十干の説明
export const TENKAN_DESCRIPTIONS: Record<Tenkan, string> = {
  甲: "力強く成長する大樹のような、リーダーシップのあるタイプ",
  乙: "美しく咲き誇る花のような、優雅で繊細なタイプ",
  丙: "すべてを照らす太陽のような、明るくエネルギッシュなタイプ",
  丁: "温かく人を照らす灯火のような、優しく献身的なタイプ",
  戊: "すべてを支える大地のような、安定感があり包容力のあるタイプ",
  己: "美しく輝く宝石のような、洗練されていて魅力的なタイプ",
  庚: "強く確かな金属のような、意志が強く正義感のあるタイプ",
  辛: "美しく輝く宝石のような、洗練されていて魅力的なタイプ",
  壬: "広く深い大海のような、自由で創造性豊かなタイプ",
  癸: "優しく潤す雨露のような、思いやりがあり柔軟なタイプ",
};

// 干合のマッピング（相性抜群の組み合わせ）
export const GOUGOU_PAIRS: Record<Tenkan, Tenkan> = {
  甲: "己",
  乙: "庚",
  丙: "辛",
  丁: "壬",
  戊: "癸",
  己: "甲",
  庚: "乙",
  辛: "丙",
  壬: "丁",
  癸: "戊",
};

/**
 * 生年月日から日干を計算する
 * 四柱推命の日干は、生年月日の干支から算出されます
 * 簡易版：1924年2月5日（甲子日）を基準日として計算
 * 注意：正確な四柱推命の計算には旧暦への変換が必要ですが、プロトタイプでは簡易計算を使用
 */
export function calculateTenkan(year: number, month: number, day: number): Tenkan {
  // 1924年2月5日（甲子日）を基準とする（より正確な基準日）
  const baseDate = new Date(1924, 1, 5); // 月は0ベースなので1が2月
  const targetDate = new Date(year, month - 1, day);
  
  // 日数の差分を計算
  const diffTime = targetDate.getTime() - baseDate.getTime();
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
  
  // 基準日の十干は「甲」（インデックス0）
  // 10日周期で十干が循環する
  const tenkanIndex = (diffDays % 10 + 10) % 10;
  
  return TENKAN_ARRAY[tenkanIndex];
}

/**
 * 相性抜群の相手タイプを取得
 */
export function getCompatibleTenkan(tenkan: Tenkan): Tenkan {
  return GOUGOU_PAIRS[tenkan];
}

/**
 * 生年月日のバリデーション
 */
export function validateBirthDate(year: number, month: number, day: number): boolean {
  if (year < 1900 || year > 2100) return false;
  if (month < 1 || month > 12) return false;
  if (day < 1 || day > 31) return false;
  
  const date = new Date(year, month - 1, day);
  return (
    date.getFullYear() === year &&
    date.getMonth() === month - 1 &&
    date.getDate() === day
  );
}

/**
 * 占いの詳細情報
 */
export interface FortuneDetails {
  todayFortune: string;
  meetingPeriod: string;
  luckyPlace: string;
}

// 今日の運勢（十干別）
export const TODAY_FORTUNE: Record<Tenkan, string> = {
  甲: "今日は新しい挑戦を始めるのに最適な日です。リーダーシップを発揮すれば、周囲からの信頼が高まります。",
  乙: "優雅さと繊細さがあなたの魅力を引き立てます。アートや文化に触れることで、運気が上昇します。",
  丙: "太陽のような明るさで、周囲を照らす存在に。積極的な行動が幸運を呼び込みます。",
  丁: "温かさと献身性が評価される日。人を思いやる行動が、あなたに良い縁をもたらします。",
  戊: "安定感と包容力が武器です。落ち着いた判断力で、重要な決断を下すのに適しています。",
  己: "洗練された魅力が輝く日。上質な時間を過ごすことで、運気が高まります。",
  庚: "正義感と意志の強さが試される日。信念を貫くことで、信頼を得られます。",
  辛: "美しさと魅力が際立つ日。自分を磨く時間を取ることで、運気が上昇します。",
  壬: "自由な発想と創造性が花開く日。新しいアイデアが成功への鍵となります。",
  癸: "思いやりと柔軟性が評価される日。周囲との調和を大切にすれば、良い結果が得られます。",
};

// 二人が出会うべき時期（十干別）
export const MEETING_PERIOD: Record<Tenkan, string> = {
  甲: "春の訪れと共に、運命の相手との出会いが訪れます。3月から5月にかけて、新しい出会いのチャンスが広がります。",
  乙: "花が咲き誇る季節、特に4月から6月にかけて、美しい縁が結ばれるでしょう。",
  丙: "夏の太陽が輝く時期、6月から8月が最も運気が高い時期です。明るい場所で出会いが待っています。",
  丁: "秋の夜長、9月から11月にかけて、温かい出会いがあなたを待っています。",
  戊: "一年を通じて安定した運気ですが、特に9月から12月にかけて、深い絆が生まれるでしょう。",
  己: "上質な時間が流れる秋から冬、10月から1月にかけて、洗練された出会いが訪れます。",
  庚: "意志の強さが試される冬から春、12月から3月にかけて、真剣な出会いが待っています。",
  辛: "美しさが際立つ季節、特に11月から2月にかけて、魅力的な出会いが訪れるでしょう。",
  壬: "自由な風が吹く春から夏、2月から7月にかけて、創造的な出会いが待っています。",
  癸: "優しい雨が降る季節、特に5月から8月にかけて、思いやりのある出会いが訪れます。",
};

// 幸運の場所（十干別）
export const LUCKY_PLACE: Record<Tenkan, string> = {
  甲: "自然豊かな公園や森林、高い建物の展望台。成長を象徴する場所があなたの運気を高めます。",
  乙: "美術館、花の咲く庭園、上品なカフェ。美しさと優雅さに満ちた場所が幸運を呼びます。",
  丙: "日当たりの良い場所、ビーチ、屋外のイベント会場。明るく開かれた場所が最適です。",
  丁: "温かみのあるレストラン、図書館、家庭的な雰囲気の場所。人を温かく迎える場所が良いでしょう。",
  戊: "歴史ある建造物、伝統的な場所、安定感のある空間。大地のようにどっしりとした場所が運気を高めます。",
  己: "高級ホテル、宝石店、上質なショップ。洗練された空間があなたの魅力を引き立てます。",
  庚: "正義を象徴する場所、裁判所近く、金属に関連する場所。強さと確かさを感じる場所が良いでしょう。",
  辛: "美しい装飾のある場所、ジュエリーショップ、上品なサロン。美しさが際立つ場所が運気を高めます。",
  壬: "海辺、大きな川の近く、広々とした場所。自由と創造性を感じる場所が最適です。",
  癸: "水に関連する場所、温泉、雨の日も楽しめる屋内施設。柔軟性と潤いを感じる場所が良いでしょう。",
};

/**
 * 占いの詳細情報を取得
 */
export function getFortuneDetails(tenkan: Tenkan): FortuneDetails {
  return {
    todayFortune: TODAY_FORTUNE[tenkan],
    meetingPeriod: MEETING_PERIOD[tenkan],
    luckyPlace: LUCKY_PLACE[tenkan],
  };
}
